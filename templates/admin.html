<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Админка</title>
    <style>
        body { font-family: sans-serif; padding: 2rem; background: #f4f4f9; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; }
        .header { display: flex; justify-content: space-between; margin-bottom: 20px; }
        input, select, textarea { width: 100%; margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background: #5c4033; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .item-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 10px 0; }
        .thumb { width: 50px; height: 50px; object-fit: cover; margin-right: 15px; border-radius: 4px; }
        .info { display: flex; align-items: center; }
        .logout-btn { background: #999; text-decoration: none; color: white; padding: 5px 15px; border-radius: 4px; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>Новая работа</h2>
            <a href="/logout" class="logout-btn">Выйти</a>
        </div>
        
        <form id="add-form">
            <input type="text" name="title" placeholder="Название" required>
            <textarea name="description" placeholder="Описание..." rows="4" required></textarea>
            <input type="number" name="price" placeholder="Цена" required>
            <select name="category">
                <option value="doll">Куклы</option>
                <option value="weaving">Ткачество</option>
                <option value="painting">Роспись</option>
                <option value="scrap">Скрапбукинг</option>
                <option value="decoupage">Декупаж</option>
                <option value="gifts">Подарки</option>
            </select>
            <label>Фотографии (можно выбрать несколько):</label>
            <!-- allow multiple files -->
            <input type="file" name="files" multiple required>
            <button type="submit">Загрузить</button>
        </form>

        <h3 style="margin-top:40px;">Товары</h3>
        <div id="items-list"></div>
    </div>

    <script>
        const form = document.getElementById('add-form');
        const list = document.getElementById('items-list');

        async function loadItems() {
            const res = await fetch('/api/items');
            const items = await res.json();
            list.innerHTML = '';
            items.forEach(item => {
                // Берем первую картинку для превью, если есть
                const img = item.images.length > 0 ? item.images[0] : '';
                list.innerHTML += `
                    <div class="item-row">
                        <div class="info">
                            ${img ? `<img src="${img}" class="thumb">` : ''}
                            <div><b>${item.title}</b><br>${item.price} ₽</div>
                        </div>
                        <button onclick="deleteItem(${item.id})" style="background:#e74c3c;">X</button>
                    </div>
                `;
            });
        }

        form.onsubmit = async (e) => {
            e.preventDefault();
            const btn = form.querySelector('button');
            btn.disabled = true; btn.innerText = "Отправка...";
            
            const formData = new FormData(form);
            // Файлы автоматически добавятся как список благодаря name="files" и multiple

            const res = await fetch('/api/items', { method: 'POST', body: formData });
            if (res.ok) {
                alert('Готово!');
                form.reset();
                loadItems();
            } else {
                alert('Ошибка загрузки');
            }
            btn.disabled = false; btn.innerText = "Загрузить";
        };

        async function deleteItem(id) {
            if(confirm('Удалить?')) {
                await fetch(`/api/items/${id}`, { method: 'DELETE' });
                loadItems();
            }
        }
        loadItems();
    </script>
</body>
</html>